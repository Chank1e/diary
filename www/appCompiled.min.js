"use strict";var app=angular.module("diary",[]);app.controller("diaryCtrl",function(e){function a(e,a){if(isNaN(e)||isNaN(a))return!1;var o=Math.pow(10,a);return Math.round(e*o)/o}e.mainView="main.html",e.loginView="login.html",e.statsView="stats.html",e.newTeacherView="newTeacher.html",e.lessonMarksView="lessonMarks.html",e.marksForDateView="marksForDate.html",e.showNewTeacher=function(){e.url=e.newTeacherView},e.showMarksForDate=function(){e.url=e.marksForDateView},e.showLogin=function(){e.url=e.loginView},e.showMain=function(){e.url=e.mainView},e.showStats=function(){e.url=e.statsView},e.average=function(e){if("undefined"!=typeof e){var o=0;return e.forEach(function(e){o+=parseInt(e)}),a(o/e.length,2)}},e.registration=function(){var e=$("#registrationForm").serialize();$.ajax({type:"POST",url:"registration_db.php",data:e,success:function(){window.location.href="/"},error:function(){window.location.href="/"}})},e.addTeacher=function(){var e=$("#teacherForm").serialize();$.ajax({type:"POST",url:"newTeacher_db.php",data:e,success:function(){window.location.href="/"},error:function(){window.location.href="/"}})};var o=get_cookie("login"),n=get_cookie("password"),r=get_cookie("type");if("pupil"==r){var s="ученик";e.isPupil=!0,e.isTeacher=!1}else if("teacher"==r){var s="учитель";e.isTeacher=!0,e.isPupil=!1}if(o&&n?(e.logInfo="Привет "+s+","+o,e.isLogged=!0):(e.logInfo="Вы не вошли",e.isLogged=!1),e.isTeacher){$.ajax({dataType:"json",url:"getTeacherData.php?login="+o,success:function(a){e.teacher=a,console.log(a)},error:function(e){console.log(e)},async:!1});for(var i=[],l=[],t=8;11>=t;t++)if("no"!==e.teacher.marks&&"undefined"!=typeof e.teacher.marks[t]){i[t]=0;for(var c=0;c<e.teacher.marks[t].length;c++)i[t]+=parseInt(e.teacher.marks[t][c]);l[t]=a(i[t]/e.teacher.marks[t].length,2)}e.avMarks=l,e.delimoe=4,"undefined"==typeof e.avMarks[8]&&(e.delimoe-=1,e.avMarks[8]=0),"undefined"==typeof e.avMarks[9]&&(e.delimoe-=1,e.avMarks[9]=0),"undefined"==typeof e.avMarks[10]&&(e.delimoe-=1,e.avMarks[10]=0),"undefined"==typeof e.avMarks[11]&&(e.delimoe-=1,e.avMarks[11]=0),e.fullAverage=(e.avMarks[8]+e.avMarks[9]+e.avMarks[10]+e.avMarks[11])/e.delimoe,e.fullAverage=a(e.fullAverage,2),isNaN(e.fullAverage)&&(e.fullAverage=0)}if(e.isPupil){var u=function(){$.ajax({dataType:"json",url:"getPupilData.php?login="+o,success:function(a){e.pupil=a,console.log(a)},error:function(){},async:!1})};u(),e.showLessonMarks=function(a){e.moreLessonId=a+1,e.url=e.lessonMarksView,e.moreLessonTitle=e.pupil.allLessons[a+1].title,e.moreLessonDates=e.pupil.allLessons[a+1].date,e.moreLessonTeacher=e.pupil.allLessons[a+1].teacherSurname+" "+e.pupil.allLessons[a+1].teacherName+" "+e.pupil.allLessons[a+1].teacherOtchestvo}}e.login=function(){var e=$("#logForm").serialize();$.ajax({type:"POST",url:"login_db.php",data:e,success:function(e){window.location.href="/",console.log(e)},error:function(){window.location.href="/"}})},e.setMark=function(){var e=$("#addMark").serialize();$.ajax({type:"POST",url:"setMark_db.php",data:e,success:function(){window.location.href="/"}})},e.logout=function(){delete_cookie("login"),delete_cookie("password"),delete_cookie("type"),window.location.href="/"},e.findMarksFromDate=function(a){var o=0;for(key in e.pupil.allLessons)o++;console.log(o),e.findedMarks=[];for(var n=0,r=function(o){"undefined"!=typeof e.pupil.allLessons[o].date&&e.pupil.allLessons[o].date.forEach(function(r,s){console.log(r),r==a&&(e.findedMarks[n]={mark:e.pupil.allLessons[o].marks[s],lesson:e.pupil.allLessons[o].title,teacher:e.pupil.allLessons[o].teacherSurname+" "+e.pupil.allLessons[o].teacherName+" "+e.pupil.allLessons[o].teacherOtchestvo},n++)})},s=1;o>=s;s++)r(s)},e.url=e.isLogged?e.mainView:e.loginView});